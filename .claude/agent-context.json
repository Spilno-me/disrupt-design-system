{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "1.0.0",
  "lastUpdated": "2025-12-14",
  "description": "AGENT-FIRST: Single source of truth for AI agents working on DDS. Read this FIRST.",

  "meta": {
    "projectName": "Disrupt Design System (DDS)",
    "currentVersion": "2.3.1",
    "nextVersion": "2.4.0",
    "majorVersion": "3.0.0",
    "phase": "pre-v3-development",
    "philosophy": "OPINIONATED - Strong design vision, minimal variants, maximum consistency"
  },

  "criticalRules": {
    "git": {
      "noClaudeAttribution": true,
      "commitFormat": "feat:|fix:|chore:|refactor:|docs:",
      "hookifyEnabled": true
    },
    "storybook": {
      "reflectReality": true,
      "noHardcodedOverrides": true,
      "rule": "Stories MUST show real component behavior. Change component/tokens first, NEVER hardcode colors in stories.",
      "changeSource": "Component code or design tokens",
      "notStories": "Don't fake behavior in stories with className overrides",
      "reference": ".claude/storybook-rules.md"
    },
    "versioning": {
      "policy": "NO_BREAKING_CHANGES_UNTIL_V3",
      "breakingChanges": [
        "Rename props",
        "Remove props",
        "Change prop types (non-compatible)",
        "Change required/optional status",
        "Change default values",
        "Remove exports"
      ],
      "safeChanges": [
        "Add new components",
        "Add optional props with defaults",
        "Add new variants",
        "Fix bugs (no API change)",
        "Add deprecation warnings (keep working)",
        "Internal refactoring (same API)"
      ],
      "versionBumps": {
        "patch": "Bug fixes only, no API change",
        "minor": "New features, backwards compatible",
        "major": "Breaking changes (v3.0.0 only!)"
      }
    },
    "tokens": {
      "zeroRawColors": true,
      "forbidden": ["#hex", "rgb()", "bg-blue-500", "text-gray-600"],
      "required": ["ALIAS tokens", "Semantic Tailwind classes"],
      "colorFormat": "oklch",
      "colorFormatRule": "ALWAYS use oklch() when defining colors in tokens.css or designTokens.ts",
      "oklchFormat": "oklch(L C H) - Lightness (0-1), Chroma (saturation), Hue (0-360)",
      "example": "oklch(0.533 0.195 264.05) instead of #2563EB",
      "why": "Perceptually uniform, consistent with existing tokens, better color scales, accessible contrast",
      "hookifyEnforces": true,
      "automation": {
        "required": true,
        "description": "MANDATORY: After editing designTokens.ts, ALWAYS run npm run generate-tokens",
        "sourceOfTruth": "src/constants/designTokens.ts",
        "generatedFiles": ["src/styles/tokens.css"],
        "script": "scripts/generate-tokens.js",
        "converts": "TypeScript ALIAS tokens â†’ CSS custom properties (--ring) in OKLCH format",
        "syncs": "ALIAS.border.focus â†’ --ring CSS variable for focus rings across all components",
        "mustRunWhen": "ANY change to src/constants/designTokens.ts"
      }
    },
    "exports": {
      "twoLevelSystem": true,
      "mustExportFrom": ["src/components/*/index.ts", "src/index.ts"],
      "alsoExport": ["Types", "Sub-components", "Hooks"],
      "missingHighPriority": ["NotificationsPanel", "QuickFilter", "DropdownMenu", "Tabs"]
    }
  },

  "workflow": {
    "editTokens": {
      "priority": "CRITICAL",
      "description": "Modify design tokens with mandatory automated CSS generation",
      "steps": [
        "1. Edit: src/constants/designTokens.ts",
        "2. MANDATORY: Run npm run generate-tokens",
        "3. Verify: src/styles/tokens.css updated automatically",
        "4. Check: Focus ring color synced (--ring CSS variable)",
        "5. Run: npm run typecheck",
        "6. Update CHANGELOG.md if user-facing"
      ],
      "automation": {
        "script": "scripts/generate-tokens.js",
        "input": "src/constants/designTokens.ts",
        "output": "src/styles/tokens.css",
        "converts": "ALIAS.border.focus (hex) â†’ --ring (oklch)",
        "why": "Single source of truth - TypeScript tokens automatically generate CSS"
      },
      "critical": "NEVER edit src/styles/tokens.css manually - it's auto-generated"
    },
    "stabilizeComponent": {
      "priority": "CRITICAL",
      "description": "Review and stabilize components for production without breaking changes",
      "steps": [
        "1. Read: .claude/component-stabilization-plan.md",
        "2. Check component category: Website-Only (FROZEN) | App-Only (CAREFUL) | Shared (EXTREME CARE)",
        "3. Website components â†’ STOP â†’ Do not touch",
        "4. App/Shared â†’ Use review checklist from stabilization plan",
        "5. Only SAFE changes: add optional props, fix bugs, improve internals",
        "6. Update CHANGELOG.md",
        "7. Run: npm run typecheck && npm run lint"
      ],
      "reference": ".claude/component-stabilization-plan.md"
    },
    "editComponent": {
      "priority": "CRITICAL",
      "steps": [
        "1. Check: Is change backwards compatible?",
        "2. Breaking? â†’ STOP â†’ Mark for v3.0.0 â†’ Ask user",
        "3. Safe? â†’ Proceed â†’ Update CHANGELOG.md",
        "4. Use design tokens only (ALIAS or semantic Tailwind)",
        "5. Run: npm run typecheck"
      ],
      "reference": "findings/index.json â†’ 001"
    },
    "createComponent": {
      "priority": "HIGH",
      "steps": [
        "1. Use Radix UI for interactive components",
        "2. Style with ALIAS tokens or semantic Tailwind classes",
        "3. Add data-testid support: ATOM (accept via props) | MOLECULE (auto-generate from props) | PAGE (hardcode)",
        "4. Export from src/index.ts + types",
        "5. Update CLAUDE.md component reference",
        "6. Create Storybook story",
        "7. This is MINOR version bump"
      ],
      "reference": ".claude/testing-quick-ref.md for testId strategy"
    },
    "refactorComponent": {
      "priority": "CRITICAL",
      "steps": [
        "1. Check if API changes",
        "2. API changes? â†’ BREAKING â†’ v3.0.0 only",
        "3. Internal only? â†’ SAFE â†’ Proceed",
        "4. Add tests for backwards compatibility"
      ],
      "reference": "findings/index.json â†’ 001"
    },
    "bumpVersion": {
      "priority": "CRITICAL",
      "steps": [
        "1. Identify change type: PATCH | MINOR | MAJOR",
        "2. MAJOR? â†’ Must be v3.0.0 (not now!)",
        "3. Update package.json version",
        "4. Update CHANGELOG.md",
        "5. Commit"
      ],
      "reference": "findings/index.json â†’ 001"
    }
  },

  "components": {
    "existingCheck": {
      "searchFirst": "src/components/ui/",
      "beforeBuilding": "ALWAYS check if component exists",
      "registry": ".claude/component-registry.json"
    },
    "stabilization": {
      "websiteComponents": {
        "status": "FROZEN",
        "location": "src/components/sections/, src/components/layout/Footer.tsx",
        "rule": "DO NOT TOUCH - Website is production-ready",
        "sharedDependencies": ["Button", "GridBlobCanvas", "Card"],
        "count": 32
      },
      "appComponents": {
        "status": "CAN_STABILIZE_CAREFULLY",
        "location": "src/components/partners/, src/components/leads/, src/components/provisioning/",
        "rule": "SAFE changes only (add optional props, fix bugs, improve internals)",
        "count": 40
      },
      "sharedPrimitives": {
        "status": "EXTREME_CARE",
        "location": "src/components/ui/",
        "rule": "ADD ONLY, NEVER CHANGE existing props/variants/defaults",
        "highRisk": ["Button", "GridBlobCanvas", "Input", "Dialog", "Card", "DataTable"],
        "count": 48
      },
      "planFile": ".claude/component-stabilization-plan.md"
    },
    "styling": {
      "preferTailwind": true,
      "staticStyles": "Use semantic Tailwind classes (bg-surface, text-primary)",
      "dynamicStyles": "Use ALIAS tokens (style={{ color: ALIAS.text.error }})",
      "shadows": "SHADOWS.sm|md|lg or shadow-sm|md|lg",
      "radius": "RADIUS.xs|sm|md|lg or rounded-xs|sm|md|lg"
    },
    "variants": {
      "philosophy": "OPINIONATED - Minimal variants, maximum consistency",
      "keepIf": [
        "Different functional purpose (primary vs destructive vs ghost)",
        "Different semantic meaning (success vs error vs warning)",
        "Improves accessibility or UX (size for touch targets)",
        "Limited options (â‰¤3-5 variants)",
        "Consumer NEEDS the choice"
      ],
      "removeIf": [
        "Purely aesthetic (shimmer vs wave vs pulse)",
        "Too many options (>5 variants)",
        "Redundant with another variant",
        "Consumer doesn't care about difference",
        "Creates inconsistency risk"
      ],
      "targetLimits": {
        "stateVariants": "4-5 max (success, warning, error, info, default)",
        "actionVariants": "4-5 max (primary, secondary, ghost, destructive, outline)",
        "sizes": "2-3 max (sm, default, lg only if essential)",
        "shapes": "2 max",
        "animations": "1 (no choice)",
        "decorative": "0-1 (avoid)"
      },
      "reductionPlan": ".claude/variant-reduction-strategy.md"
    },
    "testing": {
      "dataTestId": {
        "required": true,
        "strategy": "3-tier: Atoms accept, Molecules auto-generate, Pages hardcode",
        "atoms": {
          "description": "Primitives (Button, Badge, Input, Skeleton) - Accept data-testid, NO defaults",
          "implementation": "Extend React.HTMLAttributes, spread {...props}",
          "example": "<Button data-testid=\"login-submit-button\">Submit</Button>",
          "why": "Context-agnostic, reusable everywhere"
        },
        "molecules": {
          "description": "Composed components (LeadCard, InvoiceCard, StatsCard) - Auto-generate with override",
          "implementation": "Optional testId prop, auto-generate from props (e.g., lead.id)",
          "pattern": "const baseTestId = testId || `${componentName}-${id}`",
          "example": "<LeadCard lead={lead} /> â†’ data-testid=\"lead-card-123\"",
          "childTestIds": "Generate from base: `${baseTestId}-priority`, `${baseTestId}-edit-button`",
          "why": "QA gets testIds automatically, developers don't need to think"
        },
        "pages": {
          "description": "Top-level pages (LeadsPage, PartnersPage) - Hardcoded testIds",
          "implementation": "Hardcode data-testid on major sections",
          "example": "<div data-testid=\"leads-page\"><header data-testid=\"leads-header\">",
          "why": "Not reusable, testIds are stable and predictable"
        },
        "naming": {
          "format": "kebab-case",
          "pattern": "section-element-type",
          "atomExamples": ["login-submit-button", "settings-email-input", "user-role-select"],
          "moleculeExamples": ["lead-card-123", "invoice-card-456", "stats-card-revenue"],
          "pageExamples": ["leads-page", "leads-header", "leads-filters", "leads-table-container"]
        },
        "decisionTree": "Reusable? â†’ Composed? â†’ MOLECULE (auto-gen) : ATOM (accept) : PAGE (hardcode)",
        "quickRef": ".claude/testing-quick-ref.md"
      }
    },
    "storybook": {
      "moleculeDocumentation": {
        "required": true,
        "description": "Molecules must document the atoms they use with visible clickable links",
        "linkFormat": "Use bold markdown with arrow: **[â†’ `ComponentName`](?path=/story/core-component--all-states)**",
        "sections": [
          "List all core atoms used by the molecule",
          "Links must be bold and have â†’ arrow for visibility",
          "Link directly to AllStates story when available",
          "Add emoji header: ðŸ“¦ for atom dependencies, ðŸ”— for related links"
        ],
        "example": "See Utilities/Form stories documentation",
        "why": "Helps developers understand dependencies and find atom documentation easily"
      },
      "allStatesStory": {
        "required": true,
        "description": "MANDATORY: Every stabilized component must have an AllStates story",
        "purpose": "Single comprehensive story showing ALL possible states/variants without requiring interaction",
        "structure": {
          "storyName": "AllStates",
          "comment": "// All States (Visual Matrix - No interaction needed)",
          "wrapper": "<div className=\"space-y-8 p-6\"> or <div className=\"w-[Npx] space-y-8 p-6\">",
          "sections": "Multiple <div> blocks, each with <h4> header",
          "headerFormat": "<h4 className=\"text-sm font-semibold text-primary mb-4\">Section Title</h4>",
          "mustInclude": [
            "All variants (if component has variant prop)",
            "All sizes (if component has size prop)",
            "All shapes (if component has shape prop)",
            "Focus state with real behavior (Tab/Click to See) if interactive",
            "Any other props that change visual appearance"
          ]
        },
        "example": "See Badge.stories.tsx lines 113-179, Skeleton.stories.tsx lines 84-147, Input.stories.tsx lines 94-163, Textarea.stories.tsx lines 66-113, Label.stories.tsx lines 157-229, Checkbox.stories.tsx lines 91-154",
        "standardizedComponents": ["Badge", "Skeleton", "Input", "Textarea", "Label", "Checkbox"],
        "focusStatePattern": {
          "required": "If component accepts focus or can be interactive",
          "header": "Focus State (Real Component Behavior - Click to See) or (Tab to See)",
          "implementation": "Show actual focusable component, not fake CSS",
          "why": "Demonstrates real focus ring color from design tokens (--ring variable)"
        }
      }
    },
    "exports": {
      "current": {
        "Button": true,
        "Input": true,
        "Dialog": true,
        "DataTable": true,
        "NotificationsPanel": false,
        "QuickFilter": false,
        "DropdownMenu": false,
        "Tabs": false
      },
      "missing": ["NotificationsPanel", "QuickFilter", "DropdownMenu", "Tabs"],
      "detailsFile": "findings/index.json â†’ 002"
    }
  },

  "quickLookup": {
    "isBreaking": {
      "renameProp": true,
      "removeProp": true,
      "changeType": true,
      "changeDefault": true,
      "removeExport": true
    },
    "isSafe": {
      "addOptionalProp": true,
      "addComponent": true,
      "fixBug": true,
      "addVariant": true,
      "deprecate": true
    }
  },

  "files": {
    "findings": ".claude/findings/index.json",
    "quickRef": ".claude/findings/quick-ref.json",
    "componentRegistry": ".claude/component-registry.json",
    "stabilizationPlan": ".claude/component-stabilization-plan.md",
    "coreComponentsPlan": ".claude/core-components-stabilization.md",
    "testingQuickRef": ".claude/testing-quick-ref.md",
    "testingQA": "TESTING.md",
    "variantReduction": ".claude/variant-reduction-strategy.md",
    "storybookRules": ".claude/storybook-rules.md",
    "colorFormatRule": ".claude/color-format-rule.md",
    "v3BreakingChanges": ".claude/v3-breaking-changes.md",
    "componentBuilder": ".claude/agents/component-builder.md",
    "quickStartAgents": ".claude/QUICK-START-AGENTS.md",
    "claudeMd": "CLAUDE.md",
    "changelog": "CHANGELOG.md",
    "tokens": "src/constants/designTokens.ts"
  },

  "commands": {
    "typecheck": "npm run typecheck",
    "lint": "npm run lint",
    "build": "npm run build",
    "storybook": "npm run storybook",
    "generateTokens": "npm run generate-tokens"
  }
}
