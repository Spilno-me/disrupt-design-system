{
  "$schema": ".claude/agent-context.schema.json",
  "version": "2.1.0",
  "description": "SINGLE SOURCE OF TRUTH for AI agents. Read this ONE file for complete context.",
  "meta": {
    "project": "Disrupt Design System (DDS)",
    "version": "2.4.0",
    "designPhilosophy": "OPINIONATED - Strong design vision, minimal variants",
    "engineeringPhilosophy": "Wu Wei (無為) - See criticalRules.philosophy",
    "lastUpdated": "2025-12-15"
  },
  "criticalRules": {
    "philosophy": {
      "name": "Wu Wei (無為) - Effortless Action",
      "principle": "Work with the grain, not against it",
      "rules": {
        "simpleOverClever": {
          "do": "Let solutions emerge naturally from problems",
          "dont": "Over-engineer, add abstractions prematurely",
          "test": "Can a junior dev understand this in 30 seconds?"
        },
        "addOnlyWhatsNeeded": {
          "do": "Three similar lines > premature abstraction",
          "dont": "DRY zealotry, speculative generalization",
          "test": "Am I solving today's problem or imaginary future ones?"
        },
        "trustTheFlow": {
          "do": "Use existing patterns/tokens/components first",
          "dont": "Invent new patterns when existing ones work",
          "test": "Does agent-context.json already have this?"
        },
        "noForce": {
          "signal": "If implementation feels like a fight → STOP",
          "action": "Step back, find the natural path",
          "test": "Am I working around the system or with it?"
        },
        "backwardsCompatibility": {
          "metaphor": "Like water around rocks—adapt, don't break",
          "do": "ADD new, DEPRECATE old, never REMOVE until v3",
          "test": "Will existing consumers break?"
        }
      },
      "preCommitChecklist": [
        "Am I adding more complexity than needed?",
        "Does an existing pattern already solve this?",
        "Am I fighting the codebase structure?",
        "Will this break existing consumers?",
        "Would deletion be better than addition?"
      ],
      "quote": "The sage does not act, yet nothing is left undone. — Tao Te Ching"
    },
    "versioning": {
      "policy": "NO_BREAKING_UNTIL_V3",
      "breaking": [
        "rename props",
        "remove props",
        "change types",
        "change defaults",
        "remove exports"
      ],
      "safe": [
        "add optional props",
        "new components",
        "bug fixes",
        "add variants",
        "deprecate with warning"
      ]
    },
    "tokens": {
      "forbidden": [
        "#hex",
        "rgb()",
        "hsl()",
        "bg-blue-500",
        "text-red-600"
      ],
      "required": "ALIAS tokens OR semantic Tailwind (bg-surface, text-primary)",
      "colorFormat": "oklch",
      "afterEdit": "npm run generate-tokens",
      "colorMatrix": {
        "_CRITICAL": "CONSULT BEFORE WRITING ANY COLOR CODE",
        "file": ".claude/color-matrix.json",
        "workflow": [
          "1. Identify background category (dark/light/accent/subtle)",
          "2. Look up allowed text/icon/border colors",
          "3. Check FORBIDDEN list - never use those"
        ],
        "goldenRule": "Same color family on itself = INVISIBLE (ABYSS on ABYSS = WRONG)"
      },
      "contrastValidation": {
        "_CRITICAL": "VALIDATE WCAG CONTRAST FOR ALL COLOR COMBINATIONS",
        "file": ".claude/contrast-matrix.json",
        "wcag": {
          "AA_normalText": "4.5:1",
          "AA_largeText": "3.0:1",
          "AA_graphics": "3.0:1",
          "AAA_normalText": "7.0:1"
        },
        "commonFailures": {
          "ABYSS[200]_on_ABYSS[500]": "3.98:1 FAIL for text",
          "DEEP_CURRENT[500]_on_white": "3.57:1 FAIL for normal text (OK for large/icons)",
          "white_on_white": "1:1 INVISIBLE"
        },
        "safeDefaults": {
          "darkBg": "PRIMITIVES.white (12:1+) or SLATE[300] (8:1+)",
          "lightBg": "ABYSS[500] (12:1+) or DUSK_REEF[500] (7:1+)",
          "tealButtons": "Use DEEP_CURRENT[600] not [500] for white text"
        },
        "agentBehavior": "If user specifies failing color, REPORT contrast ratio and suggest alternative"
      }
    },
    "git": {
      "noClaudeAttribution": true,
      "format": "feat:|fix:|chore:|refactor:|docs:"
    },
    "errors": {
      "typescript": "FIX, never revert",
      "forbidden": "git reset --hard"
    }
  },
  "colors": {
    "_note": "Quick lookup - use Tailwind classes, not raw values",
    "brand": {
      "primary": {
        "class": "bg-dark text-dark",
        "hex": "#2D3142",
        "name": "Abyss"
      },
      "accent": {
        "class": "bg-accent-strong text-accent",
        "hex": "#08A4BD",
        "name": "Deep Current (Teal)"
      },
      "tertiary": {
        "class": "bg-muted text-muted",
        "hex": "#5E4F7E",
        "name": "Dusk Reef (Purple)"
      }
    },
    "semantic": {
      "error": {
        "class": "bg-error text-error border-error",
        "hex": "#F70D1A"
      },
      "success": {
        "class": "bg-success text-success border-success",
        "hex": "#22C55E"
      },
      "warning": {
        "class": "bg-warning text-warning border-warning",
        "hex": "#EAB308"
      },
      "info": {
        "class": "bg-info text-info border-info",
        "hex": "#3B82F6"
      }
    },
    "surfaces": {
      "page": {
        "class": "bg-cream",
        "hex": "#FBFBF3"
      },
      "card": {
        "class": "bg-surface bg-card",
        "hex": "#FFFFFF"
      },
      "muted": {
        "class": "bg-muted-bg",
        "hex": "#EFEDF3"
      },
      "accent": {
        "class": "bg-accent-bg",
        "hex": "#E6F7FA"
      }
    },
    "text": {
      "primary": {
        "class": "text-primary",
        "hex": "#2D3142"
      },
      "secondary": {
        "class": "text-secondary text-muted",
        "hex": "#5E4F7E"
      },
      "emphasis": {
        "class": "text-emphasis",
        "hex": "#474F5F"
      },
      "inverse": {
        "class": "text-inverse",
        "hex": "#FFFFFF"
      }
    },
    "border": {
      "default": {
        "class": "border-default",
        "hex": "#CBD5E1"
      },
      "focus": {
        "class": "border-accent ring-accent",
        "hex": "#08A4BD"
      }
    }
  },
  "shadows": {
    "rule": "Elevation = Importance + Interactivity",
    "lookup": {
      "sm": {
        "use": "data display",
        "examples": "tags, badges, stats"
      },
      "md": {
        "use": "standard",
        "examples": "cards, buttons, dropdowns"
      },
      "elevated": {
        "use": "premium emphasis",
        "examples": "KPIs, CTAs, featured"
      },
      "lg": {
        "use": "interactive overlays",
        "examples": "modals, sheets, drawers"
      },
      "xl": {
        "use": "critical attention",
        "examples": "alerts, error dialogs"
      }
    },
    "values": {
      "sm": "0 1px 3px 0 rgba(0,0,0,0.12), 0 1px 2px -1px rgba(0,0,0,0.08)",
      "md": "0 2px 8px -1px rgba(0,0,0,0.12), 0 4px 12px -2px rgba(0,0,0,0.08)",
      "elevated": "0 3px 12px -1px rgba(0,0,0,0.14), 0 10px 28px -4px rgba(0,0,0,0.10)",
      "lg": "0 4px 16px -2px rgba(0,0,0,0.12), 0 8px 24px -4px rgba(0,0,0,0.08)",
      "xl": "0 8px 24px -4px rgba(0,0,0,0.12), 0 12px 32px -6px rgba(0,0,0,0.08)"
    }
  },
  "radius": {
    "xs": "4px",
    "sm": "8px",
    "md": "12px",
    "lg": "16px",
    "xl": "20px",
    "full": "9999px"
  },
  "typography": {
    "website": {
      "font": "Pilat Extended",
      "class": "font-display",
      "scope": "website headings only"
    },
    "app": {
      "font": "Fixel",
      "class": "font-sans",
      "scope": "ALL app UI - the only allowed font"
    },
    "forbidden": {
      "_CRITICAL": "ONLY Fixel is allowed in app UI",
      "fonts": ["font-mono", "font-serif", "font-display (in app)", "any Google Font"],
      "reason": "Consistent brand identity - Fixel for all UI"
    }
  },
  "spacing": {
    "website": {
      "sectionY": "py-16 lg:py-24",
      "sectionX": "px-6 lg:px-10",
      "gap": "gap-12 lg:gap-16"
    },
    "app": {
      "page": "p-6",
      "card": "p-4 or p-6",
      "form": "gap-2",
      "section": "gap-6"
    }
  },
  "components": {
    "stabilization": {
      "website": {
        "status": "FROZEN",
        "rule": "DO NOT TOUCH"
      },
      "app": {
        "status": "CAN_STABILIZE",
        "rule": "SAFE changes only"
      },
      "shared": {
        "status": "EXTREME_CARE",
        "rule": "ADD ONLY, never change existing"
      },
      "progress": {
        "stabilized": 11,
        "total": 46,
        "percentage": "24%"
      }
    },
    "registry": {
      "ui": {
        "Badge": {
          "path": "ui/badge.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready",
          "variants": [
            "default",
            "secondary",
            "destructive",
            "outline"
          ]
        },
        "Button": {
          "path": "ui/button.tsx",
          "type": "ATOM",
          "status": "TODO",
          "testId": "TODO",
          "variants": [
            "primary",
            "secondary",
            "accent",
            "ghost",
            "destructive",
            "outline"
          ]
        },
        "Card": {
          "path": "ui/card.tsx",
          "type": "MOLECULE",
          "status": "FROZEN",
          "testId": "N/A",
          "for": "website pricing only"
        },
        "AppCard": {
          "path": "ui/app-card.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready",
          "variants": [
            "default",
            "elevated",
            "flat"
          ],
          "for": "in-app use"
        },
        "Checkbox": {
          "path": "ui/checkbox.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready"
        },
        "Input": {
          "path": "ui/input.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready"
        },
        "Label": {
          "path": "ui/label.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready"
        },
        "Select": {
          "path": "ui/select.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready",
          "subs": [
            "SelectTrigger",
            "SelectContent",
            "SelectItem",
            "SelectValue"
          ]
        },
        "Separator": {
          "path": "ui/separator.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready"
        },
        "Skeleton": {
          "path": "ui/Skeleton.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready",
          "variants": [
            "pulse",
            "shimmer",
            "wave"
          ]
        },
        "Slider": {
          "path": "ui/Slider.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "TODO"
        },
        "Textarea": {
          "path": "ui/textarea.tsx",
          "type": "ATOM",
          "status": "STABILIZED",
          "testId": "ready"
        },
        "Dialog": {
          "path": "ui/dialog.tsx",
          "type": "MOLECULE",
          "status": "STABILIZED",
          "testId": "data-slot",
          "subs": [
            "DialogTrigger",
            "DialogContent",
            "DialogHeader",
            "DialogTitle",
            "DialogDescription",
            "DialogFooter",
            "DialogClose",
            "DialogOverlay"
          ]
        },
        "Sheet": {
          "path": "ui/sheet.tsx",
          "type": "MOLECULE",
          "status": "TODO",
          "testId": "TODO"
        },
        "Tooltip": {
          "path": "ui/tooltip.tsx",
          "type": "ATOM",
          "status": "TODO",
          "testId": "TODO"
        },
        "DataTable": {
          "path": "ui/DataTable.tsx",
          "type": "MOLECULE",
          "status": "TODO",
          "testId": "TODO",
          "features": [
            "sorting",
            "selection",
            "pagination",
            "filtering"
          ]
        },
        "Form": {
          "path": "ui/form.tsx",
          "type": "ATOM",
          "status": "UTILITY",
          "testId": "N/A",
          "subs": [
            "FormField",
            "FormItem",
            "FormLabel",
            "FormControl",
            "FormMessage"
          ]
        },
        "ErrorState": {
          "path": "ui/ErrorState.tsx",
          "type": "MOLECULE",
          "status": "TODO",
          "testId": "TODO",
          "variants": [
            "default",
            "subtle",
            "prominent"
          ]
        },
        "SeverityIndicator": {
          "path": "ui/SeverityIndicator.tsx",
          "type": "ATOM",
          "status": "DOMAIN",
          "testId": "ready",
          "levels": [
            "critical",
            "high",
            "medium",
            "low",
            "none"
          ]
        }
      },
      "statusLegend": {
        "STABILIZED": "Production ready, AllStates story, tokens compliant",
        "FROZEN": "DO NOT TOUCH - website production use",
        "TODO": "Needs stabilization review",
        "UTILITY": "Infrastructure helper, not a UI primitive",
        "DOMAIN": "Domain-specific, stabilize after core"
      },
      "testIdLegend": {
        "ready": "Props spread + JSDoc examples for ATOM, or auto-gen for MOLECULE",
        "data-slot": "Compound component uses data-slot attributes (Dialog, Select, Sheet)",
        "TODO": "Needs data-testid implementation per testing-quick-ref.md",
        "N/A": "Not applicable (FROZEN or UTILITY)"
      },
      "testIdProgress": {
        "ready": 10,
        "todo": 7,
        "na": 2
      },
      "missingExports": {
        "high": [
          "QuickFilter",
          "NotificationsPanel",
          "DropdownMenu",
          "Tabs"
        ],
        "medium": [
          "Wizard",
          "WizardStepper",
          "WizardStep",
          "WizardNavigation"
        ]
      }
    }
  },
  "workflows": {
    "editComponent": "Breaking? → STOP → v3.0.0 | Safe? → Update CHANGELOG",
    "createComponent": "1. Check registry 2. Radix UI 3. Tokens only 4. Export src/index.ts 5. MINOR bump",
    "writeStory": "1. AllStates required 2. autoFocus for focus 3. No hardcoded overrides 4. Composition only",
    "writeTest": "Atoms=accept testId | Molecules=auto-gen | Pages=named regions",
    "editTokens": "1. Update designTokens.ts 2. Update tokens-reference.json 3. Update DesignTokens.mdx 4. Run npm run sync-docs",
    "afterChanges": "Run npm run sync-components && npm run sync-docs && npm run validate-context"
  },
  "storybook": {
    "modalOverlayPattern": {
      "_CRITICAL": "Modals use portals + fixed positioning - won't render inline",
      "staticPreview": {
        "use": "Default, WithForm stories (always visible)",
        "pattern": "Plain HTML div with dialog classes",
        "classes": "bg-surface text-primary font-sans rounded-lg border border-default p-6 shadow-lg",
        "example": "<div className=\"bg-surface...\"><h2>Title</h2><p>Description</p><Button>Action</Button></div>"
      },
      "interactiveDemo": {
        "use": "AllStates story only",
        "pattern": "Real Dialog with DialogTrigger (user clicks to open)",
        "example": "<Dialog><DialogTrigger asChild><Button>Open</Button></DialogTrigger><DialogContent>...</DialogContent></Dialog>"
      },
      "forbidden": {
        "defaultOpen": "Never use defaultOpen alone - breaks Storybook rendering",
        "modalFalse": "modal={false} causes context errors"
      }
    },
    "dataSlotPattern": {
      "_note": "Compound components use data-slot, not data-testid",
      "whenToUse": {
        "dataSlot": "Compound components (Dialog, Select, Sheet) - fixed internal structure",
        "dataTestid": "ATOM, MOLECULE, PAGE - consumer or auto-generated"
      },
      "components": {
        "Dialog": ["dialog", "dialog-trigger", "dialog-content", "dialog-header", "dialog-footer", "dialog-title", "dialog-description", "dialog-close", "dialog-overlay"],
        "Select": ["select-trigger", "select-content", "select-item", "select-separator"],
        "Sheet": ["sheet-trigger", "sheet-content", "sheet-header", "sheet-title"]
      },
      "testing": "container.querySelector('[data-slot=\"dialog-content\"]')"
    },
    "allStatesStory": {
      "required": true,
      "sections": ["Variants", "Sizes", "States", "Focus (use autoFocus)"],
      "headerClass": "text-sm font-semibold text-muted mb-4"
    }
  },
  "commands": {
    "typecheck": "npm run typecheck",
    "lint": "npm run lint",
    "build": "npm run build",
    "storybook": "npm run storybook",
    "generateTokens": "npm run generate-tokens",
    "syncComponents": "npm run sync-components",
    "syncDocs": "npm run sync-docs",
    "validateContext": "npm run validate-context",
    "syncAll": "npm run sync-components && npm run sync-docs && npm run validate-context"
  },
  "lazyLoad": {
    "colorMatrix": ".claude/color-matrix.json",
    "contrastMatrix": ".claude/contrast-matrix.json",
    "tokens": ".claude/tokens-reference.json",
    "storybookPatterns": ".claude/storybook-rules.md",
    "testingPatterns": ".claude/testing-quick-ref.md",
    "changelog": ".claude/changelog.json"
  },

  "humanOnly": {
    "_note": "These files are for humans in Storybook, not for agents",
    "visualTokenDocs": "src/stories/DesignTokens.mdx"
  }
}
