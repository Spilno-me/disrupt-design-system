# CONTRAST CATEGORY VALIDATION HOOK
# Enforces WCAG thresholds based on element category
#
# Categories:
#   Normal text (4.5:1) - body text, labels, buttons
#   Large text (3.0:1)  - 18pt+ regular, 14pt+ bold
#   Graphics (3.0:1)    - icons, borders, focus rings

name: "contrast-category-validation"
description: "Validates contrast ratios against correct category threshold"
enabled: true
type: "prompt"

# =============================================================================
# TRIGGER: Any file with color-related code
# =============================================================================

hooks:
  - event: "PreToolUse"
    matcher: "Edit|Write"
    condition:
      file_pattern: "\\.(tsx?|jsx?|css|mdx)$"
      content_pattern: "(text-|bg-|border-|fill-|stroke-)[a-z]|className.*color|style.*color"

    prompt: |
      ğŸ¨ CONTRAST CATEGORY CHECK REQUIRED

      Before applying colors, validate contrast based on element CATEGORY:

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ CATEGORY THRESHOLDS (WCAG AA)                          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ Normal text  â”‚ 4.5:1 â”‚ Body, labels, button text      â”‚
      â”‚ Large text   â”‚ 3.0:1 â”‚ 18pt+ regular, 14pt+ bold      â”‚
      â”‚ Graphics     â”‚ 3.0:1 â”‚ Icons, borders, focus rings    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      VALIDATION STEPS:
      1. Identify element category (text size matters!)
      2. Determine required threshold
      3. Check src/data/color-intelligence.json or MCP tools for allowed combinations
      4. Report any failures with suggested fixes

      âš ï¸ COMMON MISTAKE: Using 3.0:1 for normal text
         â†’ Button text, labels = NORMAL TEXT = needs 4.5:1
         â†’ Only icons/borders can use 3.0:1 threshold

      If contrast fails, use mcp__dds__get_accessible_colors to find alternatives

# =============================================================================
# POST-VALIDATION: Verify colors were checked
# =============================================================================

  - event: "PostToolUse"
    matcher: "Edit|Write"
    condition:
      file_pattern: "\\.(tsx?|jsx?)$"
      content_pattern: "text-(primary|secondary|tertiary|accent|success|warning|error)"

    prompt: |
      âœ… CONTRAST SELF-CHECK

      Verify the semantic tokens used have adequate contrast:

      SEMANTIC TOKEN CONTRAST (on default backgrounds):
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Token           â”‚ Ratio   â”‚ Valid For           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ text-primary    â”‚ 12:1+   â”‚ All text âœ“          â”‚
      â”‚ text-secondary  â”‚ 7:1+    â”‚ All text âœ“          â”‚
      â”‚ text-tertiary   â”‚ 3.5:1   â”‚ Large text, icons âœ“ â”‚
      â”‚ text-accent     â”‚ 3.57:1  â”‚ Large text, icons âœ“ â”‚
      â”‚ text-muted      â”‚ 2.9:1   â”‚ âŒ FAILS - avoid    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      If using text-tertiary or text-accent for normal text â†’ ISSUE

# =============================================================================
# PRIMITIVE COLOR WARNING
# =============================================================================

  - event: "PreToolUse"
    matcher: "Edit|Write"
    condition:
      content_pattern: "(bg|text|border)-(abyss|deep-current|dusk-reef|coral|wave|sunrise|harbor|slate|orange|linen)-\\d"

    prompt: |
      âš ï¸ PRIMITIVE COLOR DETECTED

      Primitive colors require manual contrast validation:

      1. Identify the background color
      2. Identify the foreground color
      3. Look up ratio in src/data/color-intelligence.json or MCP tools
      4. Apply correct category threshold:
         - Normal text: 4.5:1
         - Large text: 3.0:1
         - Graphics: 3.0:1

      PREFER semantic tokens (text-primary, bg-surface, etc.)
      which have pre-validated contrast.

      If you must use primitives, document the contrast ratio.
