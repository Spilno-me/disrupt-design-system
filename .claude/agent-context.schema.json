{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "agent-context.schema.json",
  "title": "DDS Agent Context",
  "description": "Schema for validating the DDS agent context configuration",
  "type": "object",
  "required": ["version", "meta", "criticalRules", "colors", "shadows", "components"],
  "properties": {
    "$schema": { "type": "string" },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of this schema"
    },
    "description": { "type": "string" },
    "meta": {
      "type": "object",
      "required": ["project", "version", "philosophy"],
      "properties": {
        "project": { "type": "string" },
        "version": { "type": "string" },
        "philosophy": { "type": "string" },
        "lastUpdated": { "type": "string", "format": "date" }
      }
    },
    "criticalRules": {
      "type": "object",
      "required": ["versioning", "tokens", "git", "errors"],
      "properties": {
        "versioning": {
          "type": "object",
          "properties": {
            "policy": { "type": "string" },
            "breaking": { "type": "array", "items": { "type": "string" } },
            "safe": { "type": "array", "items": { "type": "string" } }
          }
        },
        "tokens": {
          "type": "object",
          "properties": {
            "forbidden": { "type": "array", "items": { "type": "string" } },
            "required": { "type": "string" },
            "colorFormat": { "type": "string" },
            "afterEdit": { "type": "string" }
          }
        },
        "git": {
          "type": "object",
          "properties": {
            "noClaudeAttribution": { "type": "boolean" },
            "format": { "type": "string" }
          }
        },
        "errors": {
          "type": "object",
          "properties": {
            "typescript": { "type": "string" },
            "forbidden": { "type": "string" }
          }
        }
      }
    },
    "colors": {
      "type": "object",
      "description": "Quick color lookup for agents",
      "properties": {
        "_note": { "type": "string" },
        "brand": { "$ref": "#/$defs/colorGroup" },
        "semantic": { "$ref": "#/$defs/colorGroup" },
        "surfaces": { "$ref": "#/$defs/colorGroup" },
        "text": { "$ref": "#/$defs/colorGroup" },
        "border": { "$ref": "#/$defs/colorGroup" }
      }
    },
    "shadows": {
      "type": "object",
      "properties": {
        "rule": { "type": "string" },
        "lookup": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "use": { "type": "string" },
              "examples": { "type": "string" }
            }
          }
        },
        "values": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        }
      }
    },
    "components": {
      "type": "object",
      "properties": {
        "stabilization": {
          "type": "object",
          "properties": {
            "website": { "$ref": "#/$defs/stabilizationRule" },
            "app": { "$ref": "#/$defs/stabilizationRule" },
            "shared": { "$ref": "#/$defs/stabilizationRule" },
            "progress": {
              "type": "object",
              "properties": {
                "stabilized": { "type": "integer" },
                "total": { "type": "integer" },
                "percentage": { "type": "string" }
              }
            }
          }
        },
        "registry": {
          "type": "object",
          "properties": {
            "ui": {
              "type": "object",
              "additionalProperties": { "$ref": "#/$defs/componentDef" }
            },
            "statusLegend": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            },
            "missingExports": {
              "type": "object",
              "properties": {
                "high": { "type": "array", "items": { "type": "string" } },
                "medium": { "type": "array", "items": { "type": "string" } }
              }
            }
          }
        }
      }
    },
    "workflows": { "type": "object" },
    "commands": { "type": "object" },
    "lazyLoad": { "type": "object" },
    "radius": { "type": "object" },
    "typography": { "type": "object" },
    "spacing": { "type": "object" }
  },
  "$defs": {
    "colorGroup": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "class": { "type": "string" },
          "hex": { "type": "string", "pattern": "^#[0-9A-Fa-f]{6}$" },
          "name": { "type": "string" }
        },
        "required": ["class", "hex"]
      }
    },
    "stabilizationRule": {
      "type": "object",
      "properties": {
        "status": { "type": "string" },
        "rule": { "type": "string" }
      },
      "required": ["status", "rule"]
    },
    "componentDef": {
      "type": "object",
      "properties": {
        "path": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["ATOM", "MOLECULE", "UTILITY"],
          "description": "Component classification for testId strategy"
        },
        "status": {
          "type": "string",
          "enum": ["STABILIZED", "FROZEN", "TODO", "UTILITY", "DOMAIN"]
        },
        "testId": {
          "type": "string",
          "enum": ["ready", "TODO", "N/A"],
          "description": "data-testid implementation status"
        },
        "variants": { "type": "array", "items": { "type": "string" } },
        "subs": { "type": "array", "items": { "type": "string" } },
        "features": { "type": "array", "items": { "type": "string" } },
        "levels": { "type": "array", "items": { "type": "string" } },
        "for": { "type": "string" }
      },
      "required": ["path", "type", "testId"]
    }
  }
}
