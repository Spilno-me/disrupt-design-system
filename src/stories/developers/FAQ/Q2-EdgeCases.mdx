{/* @jsxRuntime automatic */}
{/* @jsxImportSource react */}
import { Meta } from '@storybook/addon-docs/blocks';
import {
  AlertTriangle,
  CheckCircle,
  XCircle,
  ArrowLeft,
} from 'lucide-react';
import {
  BrandHero,
  InfoBox,
  SectionHeader,
  GuidelineCard,
  CodeBlock,
  ABYSS,
  DEEP_CURRENT,
  DUSK_REEF,
  CORAL,
  HARBOR,
  SUNRISE,
  PRIMITIVES,
  SLATE,
  RADIUS,
  SPACING,
} from '../../brand/BrandComponents';

<Meta title="Developers/FAQ/Q2-Edge Cases" />

{/* Navigation */}
<div style={{ marginBottom: '24px' }}>
  <a href="/docs/developers-faq-overview--docs" style={{ display: 'inline-flex', alignItems: 'center', gap: '6px', fontSize: '13px', color: DEEP_CURRENT[600], textDecoration: 'none' }}>
    <ArrowLeft size={14} /> Back to FAQ Overview
  </a>
</div>

<BrandHero
  title="Q2: What About Edge Cases?"
  description="My app has unique requirements. Can DDS handle them?"
  gradient="teal"
  decorativeIcon={<AlertTriangle size={180} color={PRIMITIVES.white} strokeWidth={1} />}
/>

<div style={{ background: CORAL[50], borderRadius: RADIUS.xl, padding: '24px', border: `1px solid ${CORAL[200]}`, marginBottom: '24px' }}>
  <h4 style={{ margin: '0 0 12px 0', fontSize: '15px', fontWeight: 600, color: CORAL[700] }}>The Concern</h4>
  <p style={{ margin: 0, fontSize: '14px', color: DUSK_REEF[600], fontStyle: 'italic' }}>
    {"\"Our IncidentPage has a special modal that only appears when user has role X AND incident is in state Y. You're going to build that into DDS? For one client?\""}
  </p>
</div>

---

## The Short Answer

DDS pages are designed with configuration in mind. Components follow standards and best practices, covering 99% of common use cases. For truly unique requirements, we have clear patterns.

---

## How Configuration Works

DDS uses **callback presence** and **predicates** for configuration - not boolean flag explosion.

<div style={{ background: PRIMITIVES.white, borderRadius: RADIUS.lg, padding: '24px', border: `1px solid ${SLATE[200]}`, marginBottom: '24px' }}>
  <h4 style={{ margin: '0 0 16px 0', fontSize: '15px', fontWeight: 600, color: ABYSS[500] }}>Pattern 1: Callback Presence Controls Features</h4>
  <CodeBlock
    language="tsx"
    code={`// Delete feature enabled - pass the handler
<EntityTemplatesPage
  templates={templates}
  onTemplateDelete={handleDelete}  // Delete button appears
/>

// Delete feature disabled - omit the handler
<EntityTemplatesPage
  templates={templates}
  // No onTemplateDelete = no delete button
/>`}
  />
  <p style={{ margin: '12px 0 0 0', fontSize: '12px', color: DUSK_REEF[500] }}>
    {"No "}<code>{"showDeleteButton={false}"}</code>{" needed. No handler = no feature."}
  </p>
</div>

<div style={{ background: PRIMITIVES.white, borderRadius: RADIUS.lg, padding: '24px', border: `1px solid ${SLATE[200]}`, marginBottom: '24px' }}>
  <h4 style={{ margin: '0 0 16px 0', fontSize: '15px', fontWeight: 600, color: ABYSS[500] }}>Pattern 2: Predicates for Per-Row Conditions</h4>
  <CodeBlock
    language="tsx"
    code={`// Business rule: can't delete system templates
<EntityTemplatesPage
  templates={templates}
  onTemplateDelete={handleDelete}
  canDelete={(template) => !template.isSystem}
/>

// Combine with authorization
<EntityTemplatesPage
  templates={templates}
  onTemplateDelete={handleDelete}
  canDelete={(template) => !template.isSystem && user.can('delete')}
  canEdit={(template) => user.can('edit') && template.status !== 'locked'}
/>`}
  />
  <p style={{ margin: '12px 0 0 0', fontSize: '12px', color: DUSK_REEF[500] }}>
    {"You provide the RULE (business logic). DDS provides the UI (disabled state, tooltip, etc.)."}
  </p>
</div>

---

## The Ownership Boundary

<div style={{ background: PRIMITIVES.white, borderRadius: RADIUS.lg, padding: '24px', border: `1px solid ${SLATE[200]}`, marginBottom: '24px', overflow: 'auto' }}>
  <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px' }}>
    <thead>
      <tr style={{ borderBottom: `2px solid ${SLATE[200]}` }}>
        <th style={{ padding: '12px 16px', textAlign: 'left', color: ABYSS[500], fontWeight: 600 }}>Scenario</th>
        <th style={{ padding: '12px 16px', textAlign: 'left', color: ABYSS[500], fontWeight: 600 }}>Owner</th>
        <th style={{ padding: '12px 16px', textAlign: 'left', color: ABYSS[500], fontWeight: 600 }}>How</th>
      </tr>
    </thead>
    <tbody>
      {[
        { scenario: '"Show delete only for non-system templates"', owner: 'Consumer', ownerColor: DUSK_REEF, how: 'Pass canDelete={(t) => !t.isSystem}' },
        { scenario: '"Only admins can edit"', owner: 'Consumer', ownerColor: DUSK_REEF, how: 'Pass canEdit={() => user.role === "admin"}' },
        { scenario: '"Modal for role X + state Y"', owner: 'Consumer', ownerColor: DUSK_REEF, how: 'Render modal yourself based on your business logic' },
        { scenario: '"Delete button should be red"', owner: 'DDS', ownerColor: DEEP_CURRENT, how: 'Visual design is DDS responsibility' },
        { scenario: '"Disabled buttons should have tooltip"', owner: 'DDS', ownerColor: DEEP_CURRENT, how: 'DDS decides how to show disabled state' },
      ].map((row, idx) => (
        <tr key={idx} style={{ borderBottom: `1px solid ${SLATE[100]}` }}>
          <td style={{ padding: '12px 16px', color: ABYSS[500] }}>{row.scenario}</td>
          <td style={{ padding: '12px 16px' }}>
            <span style={{ background: row.ownerColor[100], color: row.ownerColor[700], padding: '4px 10px', borderRadius: RADIUS.full, fontSize: '11px', fontWeight: 600 }}>{row.owner}</span>
          </td>
          <td style={{ padding: '12px 16px', color: DUSK_REEF[500], fontSize: '12px' }}>{row.how}</td>
        </tr>
      ))}
    </tbody>
  </table>
</div>

<InfoBox variant="tip">
  <strong>The Line:</strong> If it's about WHO can do WHAT and WHEN = business logic = yours.
  If it's about HOW it looks and FEELS = visual design = DDS.
</InfoBox>

---

## What About Truly Unique Cases?

<div style={{ background: SUNRISE[50], borderRadius: RADIUS.lg, padding: '24px', border: `1px solid ${SUNRISE[200]}`, marginBottom: '24px' }}>
  <h4 style={{ margin: '0 0 12px 0', fontSize: '15px', fontWeight: 600, color: SUNRISE[700] }}>
    "I need a modal that appears only when user has role X AND incident is in state Y AND it's Tuesday"
  </h4>
  <p style={{ margin: '0 0 16px 0', fontSize: '13px', color: DUSK_REEF[500] }}>
    {"That's 100% business logic. Here's how you handle it:"}
  </p>
  <CodeBlock
    language="tsx"
    code={`function IncidentsRoute() {
  const { user } = useAuth()
  const [showSpecialModal, setShowSpecialModal] = useState(false)

  // YOUR business logic - DDS doesn't know or care about this
  const shouldShowSpecialModal = (incident: Incident) => {
    const isRoleX = user.role === 'X'
    const isStateY = incident.status === 'Y'
    const isTuesday = new Date().getDay() === 2
    return isRoleX && isStateY && isTuesday
  }

  return (
    <>
      <IncidentsPage
        incidents={incidents}
        onIncidentClick={(incident) => {
          if (shouldShowSpecialModal(incident)) {
            setShowSpecialModal(true)  // Your modal, your logic
          } else {
            navigate(\`/incidents/\${incident.id}\`)
          }
        }}
      />

      {/* YOUR modal - DDS doesn't provide this */}
      {showSpecialModal && <YourSpecialTuesdayModal />}
    </>
  )
}`}
  />
</div>

---

## How We Prevent DDS Bloat

<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '24px' }}>
  <div style={{ background: HARBOR[50], borderRadius: RADIUS.lg, padding: '20px', border: `1px solid ${HARBOR[200]}` }}>
    <h5 style={{ margin: '0 0 12px 0', fontSize: '14px', fontWeight: 600, color: HARBOR[700] }}>Add to DDS if:</h5>
    <ul style={{ margin: 0, paddingLeft: '16px', fontSize: '12px', color: DUSK_REEF[500] }}>
      <li>2+ products need it</li>
      <li>It's a predicate (business rule input), not UI config</li>
      <li>DDS can provide better/consistent UX</li>
      <li>It follows established patterns</li>
    </ul>
  </div>
  <div style={{ background: CORAL[50], borderRadius: RADIUS.lg, padding: '20px', border: `1px solid ${CORAL[200]}` }}>
    <h5 style={{ margin: '0 0 12px 0', fontSize: '14px', fontWeight: 600, color: CORAL[700] }}>Don't add if:</h5>
    <ul style={{ margin: 0, paddingLeft: '16px', fontSize: '12px', color: DUSK_REEF[500] }}>
      <li>Only 1 product needs it</li>
      <li>It's UI config disguised as business logic</li>
      <li>Consumer can handle it trivially</li>
      <li>It creates prop explosion</li>
    </ul>
  </div>
</div>

---

## Predicates vs UI Config

<div style={{ background: PRIMITIVES.white, borderRadius: RADIUS.lg, padding: '24px', border: `1px solid ${SLATE[200]}`, marginBottom: '24px' }}>
  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px' }}>
    <div>
      <h5 style={{ margin: '0 0 12px 0', fontSize: '14px', fontWeight: 600, color: HARBOR[700] }}>
        <CheckCircle size={14} style={{ marginRight: '6px', verticalAlign: 'middle' }} />
        Predicates (Good)
      </h5>
      <CodeBlock language="typescript" code={`// Consumer provides business rule
canDelete?: (item) => boolean
canEdit?: (item) => boolean

// DDS decides UI (disabled, hidden, tooltip)`} />
    </div>
    <div>
      <h5 style={{ margin: '0 0 12px 0', fontSize: '14px', fontWeight: 600, color: CORAL[700] }}>
        <XCircle size={14} style={{ marginRight: '6px', verticalAlign: 'middle' }} />
        UI Config Flags (Bad)
      </h5>
      <CodeBlock language="typescript" code={`// Consumer dictates UI details
showDeleteButton?: boolean
hideEditOnMobile?: boolean
deleteButtonColor?: string

// Breaks ownership model`} />
    </div>
  </div>
</div>

---

## Summary

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px', marginBottom: '24px' }}>
  <GuidelineCard type="do" title="Use predicates for conditions">canEdit, canDelete - you provide the rule, DDS provides the UI.</GuidelineCard>
  <GuidelineCard type="do" title="Handle complex logic yourself">"Role X + State Y + Tuesday" = your code, your modal, your problem.</GuidelineCard>
  <GuidelineCard type="dont" title="Ask for UI config flags">showXButton, hideYOnMobile - these break the ownership model.</GuidelineCard>
  <GuidelineCard type="dont" title="Expect DDS to know your business">DDS provides UI patterns. Your authorization and state logic stays with you.</GuidelineCard>
</div>

---

{/* Navigation */}
<div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '16px 0', borderTop: `1px solid ${SLATE[200]}` }}>
  <a href="/docs/developers-faq-q1-delivery--docs" style={{ fontSize: '13px', color: DEEP_CURRENT[600], textDecoration: 'none' }}>← Q1: Delivery</a>
  <a href="/docs/developers-faq-q3-updates--docs" style={{ fontSize: '13px', color: DEEP_CURRENT[600], textDecoration: 'none' }}>Next: Q3 Updates →</a>
</div>
